package org.opentest4j.reporting.events.core;

import org.opentest4j.reporting.events.api.ChildElement;
import org.opentest4j.reporting.events.api.Context;
import org.opentest4j.reporting.schema.Namespace;
import org.opentest4j.reporting.schema.QualifiedName;

import java.time.LocalDateTime;

public class Data extends ChildElement<Attachments, Data> {

    public static final QualifiedName ELEMENT = QualifiedName.of(Namespace.REPORTING_CORE, "data");
    public static final QualifiedName TIME = QualifiedName.of(Namespace.REPORTING_CORE, "time");

    Data(Context context) {
        super(context, ELEMENT);
    }

    public Data withTime(LocalDateTime timestamp) {
        withAttribute(TIME, timestamp.toString());
        return this;
    }

    public void addEntry(String key, String value) {
        append(context -> new Entry(context, key, value));
    }

    private static class Entry extends ChildElement<Data, Entry> {

        public static final QualifiedName ELEMENT = QualifiedName.of(Namespace.REPORTING_CORE, "entry");
        public static final QualifiedName KEY = QualifiedName.of(Namespace.REPORTING_CORE, "key");

        Entry(Context context, String key, String value) {
            super(context, ELEMENT);
            withAttribute(KEY, key);
            withContent(value);
        }
    }
}
