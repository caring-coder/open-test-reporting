package org.opentest4j.reporting.cli;

import org.opentest4j.reporting.tooling.converter.DefaultConverter;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import picocli.CommandLine.Command;
import picocli.CommandLine.Parameters;

import java.nio.file.Path;
import java.util.concurrent.Callable;

@Command(
        name = "convert",
        description = "Converts from the event-based to the hierarchical XML format"
)
public class ConvertCommand implements Callable<Integer> {

    private static final Logger LOG = LoggerFactory.getLogger(ConvertCommand.class);

    @Parameters(arity = "1")
    Path eventsXml;

    @Override
    public Integer call() throws Exception {
        var targetFile = eventsXml.resolveSibling("execution.xml");
        var converter = new DefaultConverter();
        converter.convert(eventsXml, targetFile);
        LOG.info("Converted {} to {}", eventsXml, targetFile);
        return 0;
    }
}
